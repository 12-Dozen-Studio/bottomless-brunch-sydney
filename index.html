<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bottomless Brunch Sydney</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    /* Simple reset */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, sans-serif;
      line-height: 1.5;
      background: #fafafa;
      color: #333;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-weight: 700;
      font-size: 2rem;
    }
    #search-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    #search-input {
      width: 100%;
      max-width: 400px;
      padding: 10px 14px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }
    #search-input:focus {
      outline: none;
      border-color: #0073e6;
      box-shadow: 0 0 5px rgba(0,115,230,0.5);
    }
    #card-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    @media (min-width: 700px) {
      #card-container {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    .card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      padding: 16px 20px 20px 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
      cursor: default;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }
    .card-header {
      margin-bottom: 12px;
    }
    .card-header h2 {
      font-size: 1.5rem;
      font-weight: 800;
      color: #2c3e50;
      margin-bottom: 8px;
      line-height: 1.1;
    }
    .badges-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 12px;
      margin-bottom: 12px;
    }
    .badge {
      background-color: #e1ecf9;
      color: #0073e6;
      font-weight: 600;
      font-size: 13px;
      padding: 4px 10px;
      border-radius: 9999px;
      user-select: none;
      white-space: nowrap;
      box-shadow: 0 1px 2px rgba(0,115,230,0.3);
    }
    .days-row {
      display: flex;
      gap: 6px;
      margin-bottom: 12px;
      user-select: none;
    }
    .day {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      font-size: 13px;
      font-weight: 700;
      line-height: 24px;
      text-align: center;
      color: #fff;
      background-color: #bbb;
      flex-shrink: 0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .day.open {
      background-color: #4caf50;
      box-shadow: 0 1px 5px rgba(76,175,80,0.6);
    }
    .field-row {
      font-size: 14px;
      margin-bottom: 8px;
      color: #444;
      line-height: 1.3;
    }
    .field-row strong {
      color: #2c3e50;
    }
    .icon-links {
      margin-top: auto;
      display: flex;
      gap: 16px;
      justify-content: flex-start;
    }
    .icon-links a {
      color: #0073e6;
      font-size: 20px;
      transition: color 0.2s ease;
    }
    .icon-links a:hover {
      color: #004a99;
    }
  </style>
</head>
<body>
  <h1>Bottomless Brunch Sydney</h1>
  <div id="search-container">
    <input type="text" id="search-input" placeholder="Search by suburb or name..." />
  </div>
  <div id="card-container"></div>

  <script>
    const cardContainer = document.getElementById('card-container');
    const searchInput = document.getElementById('search-input');

    // Weekday initials in order: Sun to Sat
    const WEEKDAYS = ['S','M','T','W','T','F','S'];

    // Normalize day names to weekday indexes 0=Sun ... 6=Sat
    const dayNameToIndex = {
      'sun': 0, 'sunday': 0,
      'mon': 1, 'monday': 1,
      'tue': 2, 'tues': 2, 'tuesday': 2,
      'wed': 3, 'wednesday': 3,
      'thu': 4, 'thurs': 4, 'thursday': 4,
      'fri': 5, 'friday': 5,
      'sat': 6, 'saturday': 6
    };

    // Parse days string into set of weekday indexes
    function parseDays(daysStr) {
      if (!daysStr) return new Set();
      const days = daysStr.toLowerCase().split(/[,;\s]+/).filter(Boolean);
      const dayIndexes = new Set();
      days.forEach(d => {
        if (dayNameToIndex.hasOwnProperty(d)) {
          dayIndexes.add(dayNameToIndex[d]);
        }
      });
      return dayIndexes;
    }

    // Create badge element
    function createBadge(text) {
      const span = document.createElement('span');
      span.className = 'badge';
      span.textContent = text;
      return span;
    }

    // Create day element
    function createDayElement(letter, isOpen) {
      const span = document.createElement('span');
      span.className = 'day';
      if (isOpen) span.classList.add('open');
      span.textContent = letter;
      return span;
    }

    // Create icon link element
    function createIconLink(href, iconClass, label) {
      if (!href) return null;
      const a = document.createElement('a');
      a.href = href;
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.setAttribute('aria-label', label);
      const icon = document.createElement('i');
      icon.className = iconClass;
      a.appendChild(icon);
      return a;
    }

    // Render cards with optional filter
    function renderCards(data, filterText = '') {
      cardContainer.innerHTML = '';
      const lowerFilter = filterText.toLowerCase();

      data.forEach(item => {
        const name = item['Name'] || '';
        const suburb = item['Suburb'] || '';

        if (lowerFilter && !name.toLowerCase().includes(lowerFilter) && !suburb.toLowerCase().includes(lowerFilter)) {
          return;
        }

        const card = document.createElement('div');
        card.className = 'card';

        // Header
        const header = document.createElement('div');
        header.className = 'card-header';
        const h2 = document.createElement('h2');
        h2.textContent = name;
        header.appendChild(h2);
        card.appendChild(header);

        // Badges container
        const badgesRow = document.createElement('div');
        badgesRow.className = 'badges-row';

        // Price badge
        if (item['Price (AUD)']) {
          badgesRow.appendChild(createBadge(`$${item['Price (AUD)']} per person`));
        } else if (item['Price']) {
          badgesRow.appendChild(createBadge(item['Price']));
        }

        // Cuisine badge
        if (item['Cuisine']) {
          badgesRow.appendChild(createBadge(item['Cuisine']));
        }

        // Duration badge
        if (item['Duration']) {
          badgesRow.appendChild(createBadge(item['Duration']));
        }

        if (badgesRow.childElementCount > 0) {
          card.appendChild(badgesRow);
        }

        // Days row (weekday initials with green/grey)
        // We look for field 'Days' or 'Days Open' or 'Open Days' or 'Days Available'
        const daysField = ['Days', 'Days Open', 'Open Days', 'Days Available'].find(f => item[f]);
        if (daysField) {
          const daysStr = item[daysField];
          const openDays = parseDays(daysStr);
          const daysRow = document.createElement('div');
          daysRow.className = 'days-row';
          WEEKDAYS.forEach((letter, idx) => {
            daysRow.appendChild(createDayElement(letter, openDays.has(idx)));
          });
          card.appendChild(daysRow);
        }

        // Other fields to show as label: value pairs, excluding those already shown or used for icon links
        // Exclude Name, Price (AUD), Price, Cuisine, Duration, Days fields, Website URL, Instagram URL, Map URL
        const excludeFields = new Set([
          'Name', 'Price (AUD)', 'Price', 'Cuisine', 'Duration',
          'Days', 'Days Open', 'Open Days', 'Days Available',
          'Website URL', 'Instagram URL', 'Map URL'
        ]);
        const otherFields = Object.keys(item).filter(f => item[f] && !excludeFields.has(f));

        otherFields.forEach(field => {
          const row = document.createElement('div');
          row.className = 'field-row';
          const strong = document.createElement('strong');
          strong.textContent = `${field}: `;
          row.appendChild(strong);
          row.appendChild(document.createTextNode(item[field]));
          card.appendChild(row);
        });

        // Icon links row
        const iconLinks = document.createElement('div');
        iconLinks.className = 'icon-links';
        const websiteLink = createIconLink(item['Website URL'], 'fas fa-globe', 'Website');
        const instagramLink = createIconLink(item['Instagram URL'], 'fab fa-instagram', 'Instagram');
        const mapLink = createIconLink(item['Map URL'], 'fas fa-map-marker-alt', 'Map');

        [websiteLink, instagramLink, mapLink].forEach(link => {
          if (link) iconLinks.appendChild(link);
        });
        if (iconLinks.childElementCount > 0) {
          card.appendChild(iconLinks);
        }

        cardContainer.appendChild(card);
      });
    }

    // Load CSV and initialize
    async function loadAndRenderCSV() {
      try {
        const response = await fetch('bottomless_brunch_sydney.csv');
        if (!response.ok) throw new Error('CSV file not found');
        const csvText = await response.text();
        const parsed = Papa.parse(csvText, {header: true, skipEmptyLines: true});
        const data = parsed.data;

        renderCards(data);

        searchInput.addEventListener('input', () => {
          renderCards(data, searchInput.value.trim());
        });
      } catch (error) {
        console.error('Failed to load CSV:', error);
        cardContainer.innerHTML = '<p style="text-align:center; color:#999;">Failed to load data.</p>';
      }
    }

    loadAndRenderCSV();
  </script>
</body>
</html>